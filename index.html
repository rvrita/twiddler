<!DOCTYPE html>
<html>

<head>
  <script src="jquery.js"></script>
  <script src="data_generator.js"></script>
  <link rel="stylesheet" media="all" href="css/main.css">
</head>

<body>
  <script>
  $(document).ready(function() {
    var $body = $('body');
    

    $('#refresh').click(updateTweets);
    $('#reset').click(setStream);

    /*setInterval(updateTweets, 5000);*/
    
    var stream = streams.home;

    function setStream(user) {
      stream = streams.users[user] ? streams.users[user] : streams.home;
      updateTweets();
    }

    function updateTweets() {
      $('.tweetlist').html('');
      
      var index = stream.length - 1;
      while (index >= Math.max(stream.length - 15,0)) {
        var tweet = stream[index];
        var $tweet = $('<li class="tweet"></li>');

        var $username = $('<a class="username" href="#"></a>');
        $username.text('@' + tweet.user);
        $username.click(function (e) {
          setStream(tweet.user);
          e.preventDefault();
        });
        $username.appendTo($tweet);

        var $timestamp = $('<span class="timestamp"></span>');
        $timestamp.text(tweet.created_at.toLocaleTimeString());
        $timestamp.appendTo($tweet);
        $tweet.appendTo($('.tweetlist'));

        var $message = $('<div class="message"></div>');
        $message.text(tweet.message);
        $message.appendTo($tweet);

        index -= 1;
      }
      $(".tweet:even").addClass("lightbg");
    }

    updateTweets();

  });
  </script>
  <div id='main'>
    <div class="header"> 
      <h1>Latest tweets</h1>
      <div class="buttons">
        <button id="refresh">Refresh</button>
        <button id="reset">Reset</button>
      </div>
    </div>
    <ul class="tweetlist">
    </ul>
  </div>
</body>

</html>